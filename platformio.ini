; =============================================================
; M.A.S.S. Trap â€” PlatformIO Configuration
; ESP32-S3-WROOM-1 N16R8 (16MB QD Flash / 8MB OPI PSRAM)
;
; Commands:
;   pio run                          # Build
;   pio run -t upload                # Flash via USB
;   pio run -e ota -t upload         # Flash via OTA (WiFi)
;   pio run -t uploadfs              # Upload LittleFS data/
;   pio run -t monitor               # Serial monitor
; =============================================================

[platformio]
src_dir = .

[env:mass-trap]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board = esp32-s3-devkitc-1
framework = arduino

; --- Flash & Memory (N16R8: 16MB QD Flash / 8MB OPI PSRAM) ---
board_build.flash_size = 16MB
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_build.psram_type = opi
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216

; --- Partition Table (3MB OTA + ~9.9MB LittleFS + 64KB coredump) ---
board_build.partitions = partitions.csv
board_build.filesystem = littlefs

; --- Build Flags ---
build_flags =
    -DBOARD_HAS_PSRAM

; --- Upload & Monitor ---
upload_speed = 921600
monitor_speed = 115200

; --- Library Dependencies ---
lib_deps =
    links2004/WebSockets @ ^2.4.1
    bblanchon/ArduinoJson @ ^7.0.0

; =============================================================
; OTA Upload Environment (pio run -e ota -t upload)
; =============================================================
[env:ota]
extends = env:mass-trap
upload_protocol = espota
upload_port = masstrap.local
upload_flags =
    --port=3232
    --auth=admin
